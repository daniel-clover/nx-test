"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.buildProjectFromProjectJson = exports.getNxProjectJsonPlugin = void 0;
const node_path_1 = require("node:path");
const workspaces_1 = require("../src/config/workspaces");
const fileutils_1 = require("../src/utils/fileutils");
function getNxProjectJsonPlugin(root) {
    return {
        name: 'nx-core-build-project-json-nodes',
        createNodes: [
            '{project.json,**/project.json}',
            (file) => {
                const json = (0, fileutils_1.readJsonFile)((0, node_path_1.join)(root, file));
                const project = buildProjectFromProjectJson(json, file);
                return {
                    projects: {
                        [project.name]: project,
                    },
                };
            },
        ],
    };
}
exports.getNxProjectJsonPlugin = getNxProjectJsonPlugin;
function buildProjectFromProjectJson(json, path) {
    return Object.assign({ name: (0, workspaces_1.toProjectName)(path), root: (0, node_path_1.dirname)(path) }, json);
}
exports.buildProjectFromProjectJson = buildProjectFromProjectJson;
